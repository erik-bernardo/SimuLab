<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acento Speed - Vers√£o Final</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --cor-fundo-ceu: #87ceeb;
            --cor-pista-lateral: #6a5acd;
            --cor-pista-central: #9370db;
            --cor-card-borda: #000000;
            --cor-card-fundo: #ffffff;
            --cor-texto: #ecf0f1;
            --cor-erro: #ff5252; 
            --cor-acerto: #42f47f; 
            --cor-ui-bg: rgba(0, 0, 0, 0.85);
            --cor-sombra: #000000;
        }

        body {
            background-color: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Press Start 2P', cursive;
            color: var(--cor-texto);
            font-size: 10px;
            overflow: hidden; 
        }

        #game-container {
            position: relative;
            width: 800px;
            height: 500px;
            border: 8px solid var(--cor-card-borda); 
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            overflow: hidden;
            background-color: var(--cor-fundo-ceu); 
        }

        #game-canvas {
            display: block;
        }

        .hidden { display: none !important; }

        /* UI Superior */
        #game-ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 15px;
            box-sizing: border-box;
            pointer-events: none; 
            z-index: 5;
            text-shadow: 2px 2px var(--cor-sombra);
            color: #000; 
        }

        .info-box { font-size: 1.2em; }

        /* Caixa de Dica Educacional (Flutuante) */
        #educational-tip-box {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            background-color: var(--cor-ui-bg);
            border: 4px solid var(--cor-erro);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 100;
        }

        #tip-text {
            color: white;
            line-height: 1.6;
            margin: 0;
            font-size: 0.8em;
        }

        /* Telas de Overlay */
        #feedback-box, #game-over-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 10;
        }

        button {
            font-family: 'Press Start 2P', cursive;
            padding: 15px 25px;
            font-size: 1em;
            background-color: var(--cor-acerto);
            border: none;
            cursor: pointer;
            margin-top: 20px;
            border-bottom: 5px solid #27ae60;
        }

        button:hover { background-color: #5ef799; }

        .shake { animation: shake 0.2s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-8px, 0, 0); }
            40%, 60% { transform: translate3d(8px, 0, 0); }
        }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="game-canvas" width="800" height="500"></canvas>
    
    <div id="game-ui">
        <div class="info-box">PONTOS: <span id="score-value">0</span></div>
        <div class="info-box">VIDAS: <span id="life-value">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div>
    </div>

    <div id="educational-tip-box">
        <p id="tip-text"></p>
    </div>

    <div id="feedback-box">
        <h2 id="message-text">ACENTO SPEED</h2>
        <p id="rule-tip" style="width: 80%; line-height: 1.5;"></p>
        <button id="start-button">PRESSIONE ENTER</button>
    </div>
    
    <div id="game-over-screen" class="hidden">
        <h1>FIM DE JOGO</h1>
        <p>Pontua√ß√£o Final:</p>
        <span id="final-score" style="font-size: 3em; color: var(--cor-acerto);">0</span>
        <button id="restart-button">JOGAR NOVAMENTE</button>
    </div>
</div>

<script>
const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');
const gameContainer = document.getElementById('game-container'); 
const scoreValue = document.getElementById('score-value');
const lifeValue = document.getElementById('life-value');
const gameOverScreen = document.getElementById('game-over-screen');
const finalScore = document.getElementById('final-score');
const restartButton = document.getElementById('restart-button');
const feedbackBox = document.getElementById('feedback-box');
const messageText = document.getElementById('message-text');
const ruleTip = document.getElementById('rule-tip');
const educationalTipBox = document.getElementById('educational-tip-box');
const tipText = document.getElementById('tip-text');

// --- CONSTANTES ---
const GAME_WIDTH = 800;
const GAME_HEIGHT = 500;
const NUM_LANES = 3; 
const PLAYER_LANE_Y = GAME_HEIGHT * 0.85; 
const PLAYER_SIZE = 50; 
const CARD_WIDTH = 160;
const CARD_HEIGHT = 75;
const LANE_X_POSITIONS = [160, 400, 640]; 

const BASE_SPEED = 0.15; 
const MAX_SPEED = 0.3; 
const SPEED_INCREMENT = 0.000005; 
const TIP_DURATION = 3500;

// --- BANCO DE PALAVRAS ---
const WORD_BANK = [

    // PROPAROX√çTONAS (Sempre acentuadas)
    ["P√°ssaro", "Passaro", "Passar√≥", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["√öltimo", "Ultimo", "Ultim√≥", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["P√∫blico", "Publico", "Public√≥", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["D√∫vida", "Duvida", "Duvid√°", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["L√≥gica", "Logica", "Logic√°", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["Pr√≥ximo", "Proximo", "Proxim√≥", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["Matem√°tica", "Matematica", "Matematic√°", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["M√∫sica", "Musica", "Music√°", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["F√≠sica", "Fisica", "Fisic√°", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["√Årvore", "Arvore", "Arvor√™", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["Ex√©rcito", "Exercito", "Exercit√≥", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["S√°bado", "Sabado", "Sabad√≥", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["P√°gina", "Pagina", "Pagin√°", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["Gram√°tica", "Gramatica", "Gramatic√°", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["Tr√¢nsito", "Transito", "Transit√≥", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["S√©culo", "Seculo", "Secul√≥", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["F√¥lego", "Folego", "Foleg√≥", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["√Çngulo", "Angulo", "Angul√≥", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["L√≠quido", "Liquido", "Liquid√≥", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],
    ["V√≠tima", "Vitima", "Vitim√°", "Regra: Todas as proparox√≠tonas s√£o acentuadas."],

    // OX√çTONAS (Terminadas em A, E, O, EM, ENS)
    ["Crach√°", "Cracha", "Crach√†", "Regra: Ox√≠tonas terminadas em A s√£o acentuadas."],
    ["Maraj√°", "Maraja", "Maraj√†", "Regra: Ox√≠tonas terminadas em A s√£o acentuadas."],
    ["Paj√©", "Paje", "Paj√™", "Regra: Ox√≠tonas terminadas em E s√£o acentuadas."],
    ["Jacar√©", "Jacare", "Jacar√™", "Regra: Ox√≠tonas terminadas em E s√£o acentuadas."],
    ["Dend√™", "Dende", "Dend√©", "Regra: Ox√≠tonas terminadas em E s√£o acentuadas."],
    ["Palet√≥", "Paleto", "Palet√¥", "Regra: Ox√≠tonas terminadas em O s√£o acentuadas."],
    ["Jil√≥", "Jilo", "Jil√¥", "Regra: Ox√≠tonas terminadas em O s√£o acentuadas."],
    ["Domin√≥", "Domino", "Domin√¥", "Regra: Ox√≠tonas terminadas em O s√£o acentuadas."],
    ["Algu√©m", "Alguem", "Algu√™m", "Regra: Ox√≠tonas terminadas em EM s√£o acentuadas."],
    ["Ref√©m", "Refem", "Ref√™m", "Regra: Ox√≠tonas terminadas em EM s√£o acentuadas."],
    ["Armaz√©m", "Armazem", "Armaz√™m", "Regra: Ox√≠tonas terminadas em EM s√£o acentuadas."],
    ["Cont√©m", "Contem", "Cont√™m", "Regra: Ox√≠tonas terminadas em EM s√£o acentuadas."],
    ["Vatapa", "Vatapa", "Vat√°p√°", "Regra: Ox√≠tonas terminadas em A s√£o acentuadas."],
    ["Guaran√°", "Guarana", "Guaran√†", "Regra: Ox√≠tonas terminadas em A s√£o acentuadas."],
    ["Picol√©", "Picole", "Picol√™", "Regra: Ox√≠tonas terminadas em E s√£o acentuadas."],
    ["Vov√≥", "Vovo", "Vov√¥", "Regra: Ox√≠tonas terminadas em O (aberto) s√£o acentuadas."],
    ["Vov√¥", "Vovo", "Vov√≥", "Regra: Ox√≠tonas terminadas em O (fechado) s√£o acentuadas."],
    ["Mocot√≥", "Mocoto", "Mocot√¥", "Regra: Ox√≠tonas terminadas em O s√£o acentuadas."],
    ["Ningu√©m", "Ninguem", "Ningu√™m", "Regra: Ox√≠tonas terminadas em EM s√£o acentuadas."],
    ["Mant√©ns", "Mantens", "M√°ntens", "Regra: Ox√≠tonas terminadas em ENS s√£o acentuadas."],

    // PAROX√çTONAS (L, R, N, X, PS, I, IS, US, UM, UNS, √ÉO, √ÉO, DITONGO)
    ["A√ß√∫car", "Acucar", "A√ßuc√°r", "Regra: Parox√≠tonas terminadas em R s√£o acentuadas."],
    ["Car√°ter", "Carater", "Carat√©r", "Regra: Parox√≠tonas terminadas em R s√£o acentuadas."],
    ["Rep√≥rter", "Reporter", "Report√©r", "Regra: Parox√≠tonas terminadas em R s√£o acentuadas."],
    ["√ötil", "Util", "Ut√≠l", "Regra: Parox√≠tonas terminadas em L s√£o acentuadas."],
    ["Dif√≠cil", "Dificil", "Dific√≠l", "Regra: Parox√≠tonas terminadas em L s√£o acentuadas."],
    ["Am√°vel", "Amavel", "Amav√©l", "Regra: Parox√≠tonas terminadas em L s√£o acentuadas."],
    ["Im√≥vel", "Imovel", "Imov√©l", "Regra: Parox√≠tonas terminadas em L s√£o acentuadas."],
    ["H√≠fen", "Hifen", "Hif√©n", "Regra: Parox√≠tonas terminadas em N s√£o acentuadas."],
    ["P√≥len", "Polen", "Pol√©n", "Regra: Parox√≠tonas terminadas em N s√£o acentuadas."],
    ["T√≥rax", "Torax", "Tor√°x", "Regra: Parox√≠tonas terminadas em X s√£o acentuadas."],
    ["F√™nix", "Fenix", "Fen√≠x", "Regra: Parox√≠tonas terminadas em X s√£o acentuadas."],
    ["B√≠ceps", "Biceps", "Bic√©ps", "Regra: Parox√≠tonas terminadas em PS s√£o acentuadas."],
    ["L√°pis", "Lapis", "Lap√≠s", "Regra: Parox√≠tonas terminadas em IS s√£o acentuadas."],
    ["Gr√°tis", "Gratis", "Grat√≠s", "Regra: Parox√≠tonas terminadas em IS s√£o acentuadas."],
    ["√çris", "Iris", "Ir√≠s", "Regra: Parox√≠tonas terminadas em IS s√£o acentuadas."],
    ["V√≠rus", "Virus", "Vir√∫s", "Regra: Parox√≠tonas terminadas em US s√£o acentuadas."],
    ["V√™nus", "Venus", "Ven√∫s", "Regra: Parox√≠tonas terminadas em US s√£o acentuadas."],
    ["√Ålbum", "Album", "Alb√∫m", "Regra: Parox√≠tonas terminadas em UM s√£o acentuadas."],
    ["F√≥rum", "Forum", "For√∫m", "Regra: Parox√≠tonas terminadas em UM s√£o acentuadas."],
    ["√ìrf√£o", "Orfao", "Orf√£o", "Regra: Parox√≠tonas terminadas em √ÉO s√£o acentuadas."],
    ["√ìrg√£o", "Orgao", "Org√£o", "Regra: Parox√≠tonas terminadas em √ÉO s√£o acentuadas."],
    ["S√≥t√£o", "Sotao", "Sot√£o", "Regra: Parox√≠tonas terminadas em √ÉO s√£o acentuadas."],
    ["√çm√£", "Ima", "Im√£", "Regra: Parox√≠tonas terminadas em √É s√£o acentuadas."],
    ["S√©rie", "Serie", "Seri√©", "Regra: Parox√≠tonas terminadas em ditongo s√£o acentuadas."],
    ["Gl√≥ria", "Gloria", "Glori√°", "Regra: Parox√≠tonas terminadas em ditongo s√£o acentuadas."],
    ["R√°dio", "Radio", "Radi√≥", "Regra: Parox√≠tonas terminadas em ditongo s√£o acentuadas."],
    ["R√©gua", "Regua", "Regu√°", "Regra: Parox√≠tonas terminadas em ditongo s√£o acentuadas."],
    ["D√∫zia", "Duzia", "Duzi√°", "Regra: Parox√≠tonas terminadas em ditongo s√£o acentuadas."],
    ["F√©rtil", "Fertil", "Fert√≠l", "Regra: Parox√≠tonas terminadas em L s√£o acentuadas."],
    ["V√¥lei", "Volei", "Vole√≠", "Regra: Parox√≠tonas terminadas em ditongo s√£o acentuadas."],

    // HIATOS (I e U t√¥nicos)
    ["Pa√≠s", "Pais", "Pa√≠s", "Regra: Acentua-se o I t√¥nico em hiato sozinho na s√≠laba."],
    ["Ba√∫", "Bau", "B√°u", "Regra: Acentua-se o U t√¥nico em hiato sozinho na s√≠laba."],
    ["Sa√≠da", "Saida", "Said√°", "Regra: Acentua-se o I t√¥nico em hiato sozinho na s√≠laba."],
    ["Vi√∫va", "Viuva", "Viuv√°", "Regra: Acentua-se o U t√¥nico em hiato sozinho na s√≠laba."],
    ["Ja√∫", "Jau", "J√°√∫", "Regra: Acentua-se o U t√¥nico em hiato sozinho na s√≠laba."],
    ["Ru√≠do", "Ruido", "Ruid√≥", "Regra: Acentua-se o I t√¥nico em hiato sozinho na s√≠laba."],
    ["Ego√≠sta", "Egoista", "Egoist√°", "Regra: Acentua-se o I t√¥nico seguido de S em hiato."],
    ["Ra√≠zes", "Raizes", "Raiz√©s", "Regra: Acentua-se o I t√¥nico em hiato sozinho na s√≠laba."],
    ["Hero√≠na", "Heroina", "Heroin√°", "Regra: Acentua-se o I t√¥nico em hiato sozinho na s√≠laba."],
    ["Para√≠ba", "Paraiba", "Paraib√°", "Regra: Acentua-se o I t√¥nico em hiato sozinho na s√≠laba."],
    ["Gua√≠ba", "Guaiba", "Guaib√°", "Regra: Acentua-se o I t√¥nico em hiato sozinho na s√≠laba."],
    ["Lu√≠s", "Luis", "L√∫is", "Regra: Acentua-se o I t√¥nico seguido de S em hiato."],
    ["Baliza", "Baliza", "Baliz√°", "Dica: Baliza n√£o tem acento (I n√£o √© hiato t√¥nico sozinho)."],
    ["Rainha", "Rainha", "Ra√≠nha", "Dica: Hiato seguido de NH n√£o √© acentuado."],
    ["Bainha", "Bainha", "Ba√≠nha", "Dica: Hiato seguido de NH n√£o √© acentuado."],

    // MONOSS√çLABOS T√îNICOS (A, E, O)
    ["P√°", "Pa", "P√†", "Regra: Monoss√≠labos t√¥nicos terminados em A s√£o acentuados."],
    ["P√©", "Pe", "P√™", "Regra: Monoss√≠labos t√¥nicos terminados em E s√£o acentuados."],
    ["P√≥", "Po", "P√¥", "Regra: Monoss√≠labos t√¥nicos terminados em O s√£o acentuados."],
    ["J√°", "Ja", "J√†", "Regra: Monoss√≠labos t√¥nicos terminados em A s√£o acentuados."],
    ["F√©", "Fe", "F√™", "Regra: Monoss√≠labos t√¥nicos terminados em E s√£o acentuados."],
    ["N√≥s", "Nos", "N√¥s", "Regra: Monoss√≠labos t√¥nicos terminados em O(s) s√£o acentuados."],
    ["V√≥s", "Vos", "V√¥s", "Regra: Monoss√≠labos t√¥nicos terminados em O(s) s√£o acentuados."],
    ["M√™s", "Mes", "M√©s", "Regra: Monoss√≠labos t√¥nicos terminados em E(s) s√£o acentuados."],
    ["Tr√™s", "Tres", "Tr√©s", "Regra: Monoss√≠labos t√¥nicos terminados em E(s) s√£o acentuados."],
    ["L√°", "La", "L√†", "Regra: Monoss√≠labos t√¥nicos terminados em A s√£o acentuados."],
    ["C√°", "Ca", "C√†", "Regra: Monoss√≠labos t√¥nicos terminados em A s√£o acentuados."],
    ["D√™", "De", "D√©", "Regra: Monoss√≠labos t√¥nicos terminados em E s√£o acentuados (verbo)."],
    ["Cr√™", "Cre", "Cr√©", "Regra: Monoss√≠labos t√¥nicos terminados em E s√£o acentuados."],
    ["L√™", "Le", "L√©", "Regra: Monoss√≠labos t√¥nicos terminados em E s√£o acentuados."],
    ["S√≥", "So", "S√¥", "Regra: Monoss√≠labos t√¥nicos terminados em O s√£o acentuados."],
];

let gameState = 'waiting'; 
let score = 0;
let lives = 3;
let speed = BASE_SPEED;
let playerTargetLane = 1; 
let playerCurrentX = LANE_X_POSITIONS[1]; 
let cards = []; 
let lastTime = 0;
let tipTimer = 0;
let comboCount = 0;
let hitFlashTimer = 0;

// --- L√ìGICA ---

function showFloatingFeedback(rule, correctWord) {
    tipText.innerHTML = `<span style="color: #ff5252;">ERRO!</span> A correta era <span style="color: #42f47f;">${correctWord}</span>.<br>${rule}`;
    educationalTipBox.style.opacity = '1';
    tipTimer = TIP_DURATION;
}

function generateCards() {
    const wordEntry = WORD_BANK[Math.floor(Math.random() * WORD_BANK.length)];
    const correctLane = Math.floor(Math.random() * NUM_LANES);
    let wordsInSet = [];
    let wrongOptions = [wordEntry[1], wordEntry[2]];

    for(let i = 0; i < NUM_LANES; i++) {
        if (i === correctLane) wordsInSet.push(wordEntry[0]);
        else wordsInSet.push(wrongOptions.pop());
    }

    for(let i = 0; i < NUM_LANES; i++) {
        cards.push({
            x: LANE_X_POSITIONS[i],
            y: -100,
            words: wordsInSet,
            correctLane: correctLane,
            laneIndex: i,
            ruleTip: wordEntry[3],
            passed: false
        });
    }
}

function updateGame(deltaTime) {
    if (gameState !== 'running') return;

    speed = Math.min(MAX_SPEED, speed + SPEED_INCREMENT * deltaTime);
    
    // Movimenta√ß√£o do jogador
    const targetX = LANE_X_POSITIONS[playerTargetLane];
    playerCurrentX += (targetX - playerCurrentX) * 0.2;

    // Feedback flutuante
    if (tipTimer > 0) {
        tipTimer -= deltaTime;
        if (tipTimer <= 0) educationalTipBox.style.opacity = '0';
    }

    // Flash de impacto
    if (hitFlashTimer !== 0) {
        hitFlashTimer = hitFlashTimer > 0 ? hitFlashTimer - deltaTime : Math.min(0, hitFlashTimer + deltaTime);
    }

    // Atualizar Cards
    for (let i = cards.length - 1; i >= 0; i--) {
        const card = cards[i];
        card.y += speed * deltaTime;

        // Detec√ß√£o de Colis√£o / Passagem
        if (card.y > GAME_HEIGHT * 0.75 && !card.passed) {
            card.passed = true;
            
            if (card.laneIndex === card.correctLane) {
                if (playerTargetLane === card.correctLane) {
                    // ACERTO
                    score += 10 + (comboCount * 2);
                    comboCount++;
                    scoreValue.textContent = score;
                    hitFlashTimer = 150;
                } else {
                    // ERRO (N√£o pegou a certa)
                    lives--;
                    comboCount = 0;
                    hitFlashTimer = -300;
                    showFloatingFeedback(card.ruleTip, card.words[card.correctLane]);
                    triggerShake();
                }
            } else if (playerTargetLane === card.laneIndex) {
                // ERRO (Pegou a errada)
                lives--;
                comboCount = 0;
                hitFlashTimer = -300;
                showFloatingFeedback(card.ruleTip, card.words[card.correctLane]);
                triggerShake();
            }

            updateLivesDisplay();
            if (lives <= 0) gameOver();
        }

        if (card.y > GAME_HEIGHT) cards.splice(i, 1);
    }

    if (cards.length === 0 || cards[cards.length-1].y > 300) generateCards();
}

function triggerShake() {
    gameContainer.classList.add('shake');
    setTimeout(() => gameContainer.classList.remove('shake'), 200);
}

function updateLivesDisplay() {
    lifeValue.textContent = '‚ù§Ô∏è'.repeat(Math.max(0, lives)) + 'üñ§'.repeat(Math.max(0, 3 - lives));
}

// --- DESENHO ---

function draw() {
    ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);

    // Estradas
    ctx.fillStyle = '#6a5acd'; ctx.fillRect(0, 0, 800, 500); // Fundo
    LANE_X_POSITIONS.forEach(x => {
        ctx.fillStyle = '#9370db';
        ctx.fillRect(x - 80, 0, 160, 500);
    });

    // Cards
    cards.forEach(card => {
        ctx.fillStyle = 'white';
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 4;
        ctx.fillRect(card.x - 75, card.y, 150, 60);
        ctx.strokeRect(card.x - 75, card.y, 150, 60);
        
        ctx.fillStyle = 'black';
        ctx.font = "12px 'Press Start 2P'";
        ctx.textAlign = 'center';
        ctx.fillText(card.words[card.laneIndex], card.x, card.y + 35);
    });

    // Jogador (Sombra/Bola)
    ctx.fillStyle = 'black';
    ctx.beginPath();
    ctx.arc(playerCurrentX, PLAYER_LANE_Y, 20, 0, Math.PI * 2);
    ctx.fill();

    // Flash de Acerto/Erro
    if (hitFlashTimer > 0) {
        ctx.fillStyle = 'rgba(66, 244, 127, 0.3)';
        ctx.fillRect(0,0,800,500);
    } else if (hitFlashTimer < 0) {
        ctx.fillStyle = 'rgba(255, 82, 82, 0.3)';
        ctx.fillRect(0,0,800,500);
    }
}

function gameLoop(currentTime) {
    const deltaTime = currentTime - lastTime;
    lastTime = currentTime;
    updateGame(deltaTime);
    draw();
    if (gameState === 'running') requestAnimationFrame(gameLoop);
}

// --- CONTROLES E INIT ---

function startGame() {
    gameState = 'running';
    score = 0; lives = 3; speed = BASE_SPEED;
    cards = []; comboCount = 0;
    updateLivesDisplay();
    scoreValue.textContent = '0';
    feedbackBox.classList.add('hidden');
    gameOverScreen.classList.add('hidden');
    lastTime = performance.now();
    requestAnimationFrame(gameLoop);
}

function gameOver() {
    gameState = 'gameover';
    finalScore.textContent = score;
    gameOverScreen.classList.remove('hidden');
}

window.addEventListener('keydown', (e) => {
    if (gameState === 'waiting' && e.key === 'Enter') startGame();
    if (gameState === 'running') {
        if (e.key === 'ArrowLeft') playerTargetLane = Math.max(0, playerTargetLane - 1);
        if (e.key === 'ArrowRight') playerTargetLane = Math.min(2, playerTargetLane + 1);
    }
});

restartButton.addEventListener('click', startGame);

// Inicializa√ß√£o
ruleTip.textContent = "Colete apenas as palavras com a acentua√ß√£o CORRETA. Use as SETAS para mover. Feedback de erro n√£o pausa o jogo!";
</script>

</body>
</html>
